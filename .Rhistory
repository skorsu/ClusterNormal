library(LaplacesDemon)
library(mvtnorm)
library(tidyverse)
library(DirichletReg)
library(invgamma)
library(salso)
library(rootSolve)
library(metRology)
library(ggplot2)
library(gridExtra)
library(xtable)
library(mclustcomp)
### Required Commands for building the packages: -------------------------------
uninstall()
compileAttributes()
build()
compileAttributes()
build()
install()
library(ClusterNormal)
set.seed(31807)
ci_true <- rep(1:5, 3)
dat <- rnorm(5*3, c(0, 7.5, 15, 25, 35)[ci_true], 1)
ci_init <- rep(c(0, 1, 0, 0, 0), 3)
mu_init <- c(rnorm(2), rep(0, 3))
s2_init <- c((1/rgamma(2, 1, 1)), rep(0, 3))
alpha_init <- c(rgamma(2, 1 ,1), rep(0, 3))
test <- SFDMM_SM(dat, K_max = 5, a0 = 1, b0 = 1, mu0 = 0, s20 = 100, xi0 = 1,
ci_init = ci_init, mu_init = mu_init, s2_init = s2_init,
alpha_init = alpha_init, launch_iter = 10,
a_theta = 1, b_theta = 1)
test$log_A
test
### Required Libraries: --------------------------------------------------------
library(Rcpp)
library(RcppArmadillo)
library(devtools)
library(LaplacesDemon)
library(mvtnorm)
library(tidyverse)
library(DirichletReg)
library(invgamma)
library(salso)
library(rootSolve)
library(metRology)
library(ggplot2)
library(gridExtra)
library(xtable)
library(mclustcomp)
### Required Commands for building the packages: -------------------------------
uninstall()
compileAttributes()
build()
install()
library(ClusterNormal)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(mclustcomp)
library(ClusterNormal)
library(salso)
library(foreach)
library(doParallel)
library(doRNG)
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 10000)
### Required Commands for building the packages: -------------------------------
uninstall()
compileAttributes()
build()
install()
library(ClusterNormal)
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
rm(list = ls())
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 1000)
model_time <- Sys.time() - start_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
par(mfrow = c(2, 2))
for(i in 1:10){
plot_name <- paste0("mu", i)
plot(test_result$iter_mu[, i], type = "l", xlab = "Iterations", ylab = "mu",
main = plot_name)
}
### Required Commands for building the packages: -------------------------------
uninstall()
compileAttributes()
build()
install()
library(ClusterNormal)
rm(list = ls())
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 1000)
model_time <- Sys.time() - start_time
model_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
par(mfrow = c(2, 2))
for(i in 1:10){
plot_name <- paste0("mu", i)
plot(test_result$iter_mu[, i], type = "l", xlab = "Iterations", ylab = "mu",
main = plot_name)
}
par(mfrow = c(2, 2))
for(i in 1:10){
plot_name <- paste0("s2_", i)
plot(test_result$iter_s2[, i], type = "l", xlab = "Iterations", ylab = "s2",
main = plot_name)
}
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
rm(list = ls())
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, -c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 1000)
model_time <- Sys.time() - start_time
model_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
par(mfrow = c(2, 2))
for(i in 1:10){
plot_name <- paste0("mu", i)
plot(test_result$iter_mu[, i], type = "l", xlab = "Iterations", ylab = "mu",
main = plot_name)
}
rm(list = ls())
### Data Simulation: (1)
set.seed(1843)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(10, 20, 30)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 1000)
model_time <- Sys.time() - start_time
model_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
test_result$log_A
is.nan(test_result$log_A)
sum(is.nan(test_result$log_A))
sum(is.infinite(test_result$log_A))
sum(is.nan(test_result$log_A))
sum(is.infinite(test_result$log_A))
test_result$iter_assign
apply(test_result$iter_assign, 1, mean)
apply(test_result$iter_assign, 1, function(x){length(unique(x))})
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot()
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot(type = "l")
n_active <- apply(test_result$iter_assign, 1, function(x){length(unique(x))})
quantile(n_active)
table(n_active)
n_active <- apply(test_result$iter_assign, 1, function(x){length(unique(x))})
table(n_active)
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot(type = "l", ylim = c(1, 10))
mean(n_active)
c(mean(n_active), sd(n_active))
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
rm(list = ls())
### Data Simulation: (2)
set.seed(12441)
N <- 500
K <- 3
ci_true <- sample(1:K, N, replace = TRUE, prob = c(0.25, 0.35, 0.4))
dat_sim <- rnorm(N, c(7, 12, 17)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 10000)
model_time <- Sys.time() - start_time
model_time
60 * 1.049174
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
n_active <- apply(test_result$iter_assign, 1, function(x){length(unique(x))})
table(n_active)
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot(type = "l", ylim = c(1, 10))
c(mean(n_active), sd(n_active))
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
rm(list = ls())
### Data Simulation: (3)
set.seed(12441)
N <- 500
K <- 5
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, c(0, 7.5, 15, 25, 35)[ci_true], 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 10000)
model_time <- Sys.time() - start_time
model_time
model_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
n_active <- apply(test_result$iter_assign, 1, function(x){length(unique(x))})
table(n_active)
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot(type = "l", ylim = c(1, 10))
c(mean(n_active), sd(n_active))
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
rm(list = ls())
### Data Simulation: (4)
set.seed(12441)
N <- 500
K <- 5
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, (c(0, 7.5, 15, 25, 35)[actual_clus])/2, 1)
rm(list = ls())
### Data Simulation: (4)
set.seed(12441)
N <- 500
K <- 5
ci_true <- sample(1:K, N, replace = TRUE)
dat_sim <- rnorm(N, (c(0, 7.5, 15, 25, 35)[ci_true])/2, 1)
ggplot(data.frame(x = dat_sim, ci_true), aes(x = x, fill = factor(ci_true))) +
geom_histogram(bins = 100) +
theme_bw()
start_time <- Sys.time()
test_result <- SFDMM_model(iter = 10000, K_max = 10, init_assign = rep(0, 500),
y = dat_sim, a0 = 1, b0 = 1, mu0 = 0, s20 = 100,
xi0 = 1, a_theta = 1, b_theta = 1, launch_iter = 10,
print_iter = 10000)
model_time <- Sys.time() - start_time
model_time
table(salso(test_result$iter_assign[-c(1:7500), ], maxNClusters = 10), ci_true)
n_active <- apply(test_result$iter_assign, 1, function(x){length(unique(x))})
table(n_active)
apply(test_result$iter_assign, 1, function(x){length(unique(x))}) %>%
plot(type = "l", ylim = c(1, 10))
c(mean(n_active), sd(n_active))
ac <- factor(test_result$sm_status)
levels(ac) <- c("Reject", "Accept")
sm <- factor(test_result$split_or_merge)
levels(sm) <- c("Merge", "Split")
table(ac, sm)
install.packages("dirichletprocess")
library(dirichletprocess)
knitr::opts_chunk$set(echo = TRUE)
library(ClusterNormal)
library(tidyverse)
library(factoextra)
library(cluster)
library(EMCluster)
library(AntMAN)
library(dirichletprocess)
library(salso)
### Function: Simulating the data based on the scenario
f_data_sim <- function(sim_seed, scenario_index){
### place for storing result.
actual_clus <- NULL
dat <- NULL
set.seed(sim_seed)
if(! scenario_index %in% 1:4){
warning("invalid scenario. we have only 4 scenarios")
} else {
if(scenario_index == 1){
actual_clus <- sample(1:2, 500, replace = TRUE)
dat <- rnorm(500, c(-5, 5)[actual_clus])
} else if(scenario_index == 2){
actual_clus <- sample(1:5, 500, replace = TRUE)
dat <- rnorm(500, (c(0, 7.5, 15, 25, 35))[actual_clus])
} else if(scenario_index == 3){
actual_clus <- sample(1:2, 500, replace = TRUE)
dat <- rnorm(500, c(-5, 5)[actual_clus], 3)
} else {
actual_clus <- sample(1:5, 500, replace = TRUE)
dat <- rnorm(500, (c(0, 7.5, 15, 25, 35)[actual_clus])/2, 1)
}
}
### return the simulated data
result <- data.frame(actual_clus, dat)
return(result)
}
### Function: Compute average silhouette for k clusters
### https://uc-r.github.io/kmeans_clustering
avg_sil <- function(k, data_clus) {
km.res <- kmeans(data_clus, centers = k)
ss <- silhouette(km.res$cluster, dist(data_clus))
mean(ss[, 3])
}
### Function: Calculate the BIC for EM algorithm
k_EM_BIC <- function(data_clus, k, em_opt){
### Initialize the model
init_EM <- init.EM(data_clus, nclass = k, EMC = em_opt,
stable.solution = TRUE, min.n = 1, min.n.iter = 10,
method = c("Rnd.EM"))
### Calculate BIC
em.bic(scale(data_list$dat), init_EM)
}
dat_sim <- f_data_sim(31807, 1)
dat_y <- as.numeric(scale(dat_sim$dat, center = FALSE, scale = FALSE))
### K-mean
k_means_sil <- rep(NA, 9)
for(i in 2:10){
k_means_sil[(i-1)] <- avg_sil(i, dat_y)
}
km_method <- kmeans(dat_y, which.max(k_means_sil) + 1)
table(km_method$cluster, dat_sim$actual_clus)
### PAM
pam_sil <- rep(NA, 9)
for(i in 2:10){
pam_sil[(i-1)] <- mean(silhouette(pam(dat_y, i))[, 3])
}
pam_method <- kmeans(dat_y, which.max(pam_sil) + 1)
table(pam_method$cluster, dat_sim$actual_clus)
### EM
em_option <- .EMControl(short.iter = 1)
em_BIC <- rep(NA, 9)
for(i in 2:10){
em_BIC[(i-1)] <- k_EM_BIC(data.frame(dat_y), i, em_option)
}
EM_opt <- which.min(em_BIC) + 1
em_method <- emcluster(data.frame(dat_y), emobj = init.EM(data.frame(dat_y), nclass = EM_opt,
EMC = em_option, stable.solution = TRUE,
min.n = 1, min.n.iter = 10,
method = c("Rnd.EM")),
EMC = em_option, assign.class = TRUE)$class
table(em_method, dat_sim$actual_clus)
### AntMAN
AntMAN_MCMC <- AM_mcmc_parameters(niter = 10000, burnin = 5000, thin = 1,
verbose = 1, output = c("CI", "K"),
parallel = FALSE, output_dir = NULL)
data_hyper <- AM_mix_hyperparams_uninorm(m0 = 0, k0 = 1, nu0 = 0.01, sig02 = 0.01)
cluster_hyper <- AM_mix_weights_prior_gamma(a = 1, b = 1)
AntMAN_mod<- AntMAN::AM_mcmc_fit(y = dat_y, initial_clustering = rep(1, 500),
mix_kernel_hyperparams = data_hyper,
mix_weight_prior = cluster_hyper,
mcmc_parameters = AntMAN_MCMC)
AntMAN_method <- as.numeric(salso(AM_clustering(AntMAN_mod), maxNClusters = 10))
table(AntMAN_method, dat_sim$actual_clus)
### DP
### DP
DirichletProcessGaussian(as.matrix(dat_y))
### DP
DirichletProcessGaussian(as.matrix(dat_y), g0Priors = c(0, 1, 0.01, 0.01))
### DP
DirichletProcessGaussian(as.matrix(dat_y), g0Priors = c(0, 1, 0.01, 0.01), alphaPriors = c(1, 1))
dp_mod <- DirichletProcessGaussian(as.matrix(dat_y),
g0Priors = c(0, 1, 0.01, 0.01), alphaPriors = c(1, 1))
dp_mod <- DirichletProcessGaussian(as.matrix(dat_y),
g0Priors = c(0, 1, 0.01, 0.01), alphaPriors = c(1, 1))
Fit(dp_mod, 10000, updatePrior = FALSE, progressBar = TRUE)
dp_fit <- Fit(dp_mod, 10000, updatePrior = FALSE, progressBar = TRUE)
dp_fit$labelsChain
length(dp_fit$labelsChain)
dp_fit$clusterLabels
for(i in 1:5000){
dp_clus[(5000 + i), ] <- dp_fit$labelsChain[[(5000 + i)]]
}
dp_clus <- matrix(NA, nrow = 5000, ncol = 500)
for(i in 1:5000){
dp_clus[(5000 + i), ] <- dp_fit$labelsChain[[(5000 + i)]]
}
dp_fit$labelsChain[[(5000 + i)]]
dp_clus <- matrix(NA, nrow = 5000, ncol = 500)
for(i in 1:5000){
dp_clus[i, ] <- dp_fit$labelsChain[[(5000 + i)]]
}
salso(dp_clus, maxNClusters = 10)
table(salso(dp_clus, maxNClusters = 10), dat_sim$actual_clus)
for(i in 1:4){
print(paste0("============== Scenario ", i, " (Raw Data) =============="))
dat_sim <- f_data_sim(31807, i)
dat_y <- as.numeric(scale(dat_sim$dat, center = FALSE, scale = FALSE))
### K-mean
k_means_sil <- rep(NA, 9)
for(i in 2:10){
k_means_sil[(i-1)] <- avg_sil(i, dat_y)
}
km_method <- kmeans(dat_y, which.max(k_means_sil) + 1)
print("K-means: ")
table(km_method$cluster, dat_sim$actual_clus) %>% print()
print(" ")
### PAM
pam_sil <- rep(NA, 9)
for(i in 2:10){
pam_sil[(i-1)] <- mean(silhouette(pam(dat_y, i))[, 3])
}
pam_method <- kmeans(dat_y, which.max(pam_sil) + 1)
print("PAM: ")
table(pam_method$cluster, dat_sim$actual_clus)
print(" ")
### EM
em_option <- .EMControl(short.iter = 1)
em_BIC <- rep(NA, 9)
for(i in 2:10){
em_BIC[(i-1)] <- k_EM_BIC(data.frame(dat_y), i, em_option)
}
EM_opt <- which.min(em_BIC) + 1
em_method <- emcluster(data.frame(dat_y), emobj = init.EM(data.frame(dat_y), nclass = EM_opt,
EMC = em_option, stable.solution = TRUE,
min.n = 1, min.n.iter = 10,
method = c("Rnd.EM")),
EMC = em_option, assign.class = TRUE)$class
print("EM: ")
table(em_method, dat_sim$actual_clus)
print(" ")
### AntMAN
AntMAN_MCMC <- AM_mcmc_parameters(niter = 10000, burnin = 5000, thin = 1,
verbose = 1, output = c("CI", "K"),
parallel = FALSE, output_dir = NULL)
data_hyper <- AM_mix_hyperparams_uninorm(m0 = 0, k0 = 1, nu0 = 0.01, sig02 = 0.01)
cluster_hyper <- AM_mix_weights_prior_gamma(a = 1, b = 1)
AntMAN_mod<- AntMAN::AM_mcmc_fit(y = dat_y, initial_clustering = rep(1, 500),
mix_kernel_hyperparams = data_hyper,
mix_weight_prior = cluster_hyper,
mcmc_parameters = AntMAN_MCMC)
AntMAN_method <- as.numeric(salso(AM_clustering(AntMAN_mod), maxNClusters = 10))
print("AntMAN: ")
table(AntMAN_method, dat_sim$actual_clus)
print(" ")
### DP
dp_mod <- DirichletProcessGaussian(as.matrix(dat_y),
g0Priors = c(0, 1, 0.01, 0.01), alphaPriors = c(1, 1))
dp_fit <- Fit(dp_mod, 10000, updatePrior = FALSE, progressBar = TRUE)
dp_clus <- matrix(NA, nrow = 5000, ncol = 500)
for(i in 1:5000){
dp_clus[i, ] <- dp_fit$labelsChain[[(5000 + i)]]
}
print("DP: ")
table(salso(dp_clus, maxNClusters = 10), dat_sim$actual_clus)
print(" ")
}
